<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>caraya</title>
</head>
<body>
    <!--boton operacion-->
    <button id="operacionBtn1"
    style="width: 150px; height: 30px; background-color: moccasin; color: black;
    font-size: 20px; justify-content: center; position: absolute; top: 1%; border: none; border-radius: 5%;
    cursor: pointer;">Operacion</button>

    <!--campo oculto para escrivir la operacion-->
    <div id="campo1" style="display: none; position: absolute; top: 10%;">
        <input type="text" id="nombreOperacion" placeholder="nombre de la operacion">
        <button id="guardarBtn1">Guardar</button>
    </div>
    <!--resultado debajo del boton operacion-->
    <div id="resultado1" style="position: absolute; top: 7%; width: 80px; height: 80px;"></div>

    <!--boton operario-->
    <button id="operarioBtn2"
    style="width: 150px; height: 30px; background-color: lightgreen; color: black;
    font-size: 20px; justify-content: center; position: absolute; top: 1%; left: 57%; border: none; border-radius: 5%;
    cursor: pointer;">Operario</button>

    <!--campo ocul;to para escrivir el operario-->
    <div id="campo2" style="display: none; position: absolute; top: 10%; left: 50%; z-index: 1000;">
        <input type="text" id="nombreOperario" placeholder="nombre del operario">
        <button id="guardarBtn2">Guardar</button>
    </div>
    <!--resultado debajo del boton operario-->
    <div id="resultado2" style="position: absolute; top: 7%; left: 70%;"></div>

    <!--boton redondo-->
    <button id="redondoBtn"
    style="border-radius: 50%; width: 200px; height: 200px; background-color: #4CAF50;
    justify-content: center; position: absolute; top: 15%; left: 25%; border: none;
    cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center;
    "><span class="top" style="font-size: 20px; color: white; position: absolute; top: 10%; display: none;">0</span>
      <span class="center" style="font-size: 60px; color: black;">0</span>
      <span class="height" style="font-size: 20px; color: white; position: absolute; top: 80%; display: none;">0</span></button>

    <!--boton porcentaje-->
    <button id="porcentaje"
    style="width: 80px; height: 80px; background-color: darkgray; color: black;
    font-size: 20px; justify-content: center; position: absolute; top: 55%; left: 10%; border: none;
    border-radius: 5%; line-height: 1.4;">%<br>0</button>

    <!--boton meta-->
    <button id="metaBtn"
    style="width: 80px; height: 80px; background-color: darkgray; color: black;
    font-size: 20px; justify-content: center; position: absolute; top: 55%; left: 40%; border: none;
    border-radius: 5%; cursor: pointer; line-height: 1.4;">Meta<br>0</button>

    <!--campo oculto para la meta-->
    <div id="campo3" style="display: none; position: absolute; top: 70%; left: 40%; z-index: 1000;">
      <input type="text" id="nombreMeta" placeholder="nombre de la meta">
      <button id="guardarBtn3">Guardar</button>
    </div>

    <!--boton dia-->
    <button id="diaBtn"
    style="width: 80px; height: 80px; background-color: darkgrey; color: black; 
    font-size: 20px; justify-content: center; position: absolute; top: 55%; left: 70%; border: none;
    border-radius: 5%; line-height: 1.4;">Dia<br>0</button>

    <!--boton ritmo-->
    <button id="ritmoBtn"
    style="width: 80px; height: 80px; background-color: darkgrey; color: black;
    font-size: 20px; justify-content: center; position: absolute; top: 70%; left:70%; border: none;
    border-radius: 5%; line-height: 1.4;">Ritmo<br>0</button> 
    
    <!--boton saldo-->
    <button style="width: 80px; height: 80px; background-color: darkgray; color: black;
    font-size: 20px; justify-content: center; position: absolute; top: 70%; left: 10%; border: none;
    border-radius: 5%; line-height: 1.4;">Saldo<br>0</button>

    <!--boton acumulado-->
    <button style="width: 80px; height: 80px; background-color: darkgray; color: black;
    font-size: 20px; justify-content: center; position: absolute; top: 70%; left: 40%; border: none;
    border-radius: 5%; line-height: 1.4;">ACC<br>0</button>

    <!--boton de cerrar secion-->
    <button style="width: 150px; height: 30px; background-color: indianred; color: black; 
    font-size: 20px; justify-content: center; position: absolute; top: 90%; border: none;
    border-radius: 5%; cursor: pointer;">Cerrar Sesion</button>
<script>
// ===== OPERACIÓN =====
const operacionBtn1 = document.getElementById("operacionBtn1");
const campo1 = document.getElementById("campo1");
const guardarBtn1 = document.getElementById("guardarBtn1");
const input1 = document.getElementById("nombreOperacion");
const resultado1 = document.getElementById("resultado1");

operacionBtn1.addEventListener("click", () => {
  campo1.style.display = "block";
  input1.focus();
});

guardarBtn1.addEventListener("click", () => {
  const texto = input1.value.trim();
  if (texto !== "") {
    resultado1.textContent = "⛏️ " + texto;
    input1.value = "";
    campo1.style.display = "none";
  }
});

// ===== OPERARIO =====
const operarioBtn2 = document.getElementById("operarioBtn2");
const campo2 = document.getElementById("campo2");
const guardarBtn2 = document.getElementById("guardarBtn2");
const input2 = document.getElementById("nombreOperario");
const resultado2 = document.getElementById("resultado2");

operarioBtn2.addEventListener("click", () => {
  campo2.style.display = "block";
  input2.focus();
});

guardarBtn2.addEventListener("click", () => {
  const texto = input2.value.trim();
  if (texto !== "") {
    resultado2.textContent = "👷 " + texto;
    input2.value = "";
    campo2.style.display = "none";
  }
});

// ===== BOTONES PRINCIPALES =====
const redondoBtn = document.getElementById("redondoBtn");
const topNum = redondoBtn.querySelector(".top");
const centerNum = redondoBtn.querySelector(".center");
const heightNum = redondoBtn.querySelector(".height");
const porcentajeBtn = document.getElementById("porcentaje");
const metaBtn = document.getElementById("metaBtn");
const ritmoBtn = document.getElementById("ritmoBtn");

let clickCount = 0;
let timer = null;
let seconds = 0;
let meta = 0;
let horaInicio = new Date();
let clickTimes = [];

// 🌀 Reiniciar botón
function reiniciarBoton() {
  clearInterval(timer);
  clickCount = 0;
  seconds = 0;
  centerNum.textContent = "0";
  topNum.style.display = "none";
  heightNum.style.display = "none";
  porcentajeBtn.innerHTML = `%<br>0`;
  ritmoBtn.innerHTML = `Ritmo<br>0`;
  horaInicio = new Date();
  clickTimes = [];
  console.log("🔄 Botón reiniciado automáticamente a la hora exacta");

  redondoBtn.style.backgroundColor = "#2E7D32";
  setTimeout(() => (redondoBtn.style.backgroundColor = "#4CAF50"), 1000);
}

// 🎯 Programar reinicio cada hora exacta
function programarReinicioCadaHora() {
  const ahora = new Date();
  const minutos = ahora.getMinutes();
  const segundos = ahora.getSeconds();
  const msHastaHora = ((60 - minutos - 1) * 60 + (60 - segundos)) * 1000;

  setTimeout(() => {
    reiniciarBoton();
    setInterval(reiniciarBoton, 3600000);
  }, msHastaHora);

  console.log(
    `🕒 Reinicio programado para la próxima hora en ${(
      msHastaHora / 1000 / 60
    ).toFixed(2)} minutos`
  );
}

programarReinicioCadaHora();

// ===== FUNCIONES DE CÁLCULO =====

// ✅ Actualiza el porcentaje
function actualizarPorcentaje() {
  if (meta > 0) {
    const porcentaje = ((clickCount / meta) * 100).toFixed(1);
    porcentajeBtn.innerHTML = `%<br>${porcentaje}`;
  } else {
    porcentajeBtn.innerHTML = `%<br>0`;
  }
}

// ✅ Nueva función de ritmo mejorada
function actualizarRitmo() {
  const ahora = new Date();

  // Minuto actual dentro de la hora (0–59)
  const minutoActual = ahora.getMinutes();

  // Si es la primera vez, definimos la hora de inicio
  if (!horaInicio) horaInicio = new Date();

  const minutosTranscurridos = (ahora - horaInicio) / 1000 / 60;
  const minutosRestantes = Math.max(0, 60 - minutoActual);

  if (minutosTranscurridos > 0) {
    // Ritmo actual (clicks/hora)
    const ritmoPorHora = (clickCount / minutosTranscurridos) * 60;

    // Proyección real al final de la hora actual
    const proyeccionHora = clickCount + (ritmoPorHora / 60) * minutosRestantes;

    ritmoBtn.innerHTML = `Ritmo<br>${Math.round(proyeccionHora)}`;
  }
}

// ⚡ Evento de clic en el botón redondo
redondoBtn.addEventListener("click", () => {
  clickCount++;
  centerNum.textContent = clickCount;

  actualizarPorcentaje();
  actualizarRitmo(); // ✅ se recalcula el ritmo en cada clic

  // ===== Control del cronómetro inferior (lap) =====
  if (clickCount === 1) {
    seconds = 0;
    heightNum.textContent = seconds;
    heightNum.style.display = "block";

    timer = setInterval(() => {
      seconds++;
      heightNum.textContent = seconds;
    }, 1000);
  } else {
    topNum.textContent = seconds;
    topNum.style.display = "block";

    clearInterval(timer);
    seconds = 0;
    heightNum.textContent = seconds;
    heightNum.style.display = "block";

    timer = setInterval(() => {
      seconds++;
      heightNum.textContent = seconds;
    }, 1000);
  }
});

// ===== BOTÓN META =====
const campo3 = document.getElementById("campo3");
const guardarBtn3 = document.getElementById("guardarBtn3");
const input3 = document.getElementById("nombreMeta");

metaBtn.addEventListener("click", () => {
  campo3.style.display = "block";
  input3.focus();
});

guardarBtn3.addEventListener("click", () => {
  const valor = parseInt(input3.value.trim());
  if (!isNaN(valor) && valor > 0) {
    meta = valor;
    metaBtn.innerHTML = `Meta<br>${meta}`;
    input3.value = "";
    campo3.style.display = "none";
    actualizarPorcentaje();
  } else {
    alert("Por favor ingresa un número válido para la meta.");
  }
});
</script>

</body>
</html>
